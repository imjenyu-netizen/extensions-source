apply plugin: 'com.android.application'
// 严禁在此处写 apply plugin: 'kotlin-android'

ext {
    extName = 'Gomuraw'
    extClass = '.Gomuraw'
    extVersionCode = 30
}

// 1. 先加载官方脚本
apply from: "$rootDir/common.gradle"

// 2. 强制覆盖配置，解决 33KB 和 compileSdk 缺失问题
android {
    compileSdk 34
    namespace "eu.kanade.tachiyomi.extension.ja.gomuraw"

    sourceSets {
        main {
            // 暴力指定：不管官方怎么设，强制把当前目录下的 src 文件夹作为源码
            java.srcDirs = [file("src")]
            kotlin.srcDirs = [file("src")]
        }
    }

    defaultConfig {
        minSdk 21
        targetSdk 34
    }
}

// 3. 强制补全 Kotlin 编译任务，防止被跳过
tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
    kotlinOptions {
        jvmTarget = "17"
        freeCompilerArgs += "-opt-in=kotlin.RequiresOptIn"
    }
}
